{"ast":null,"code":"import React,{useEffect,useState}from'react';import{API_URL,GOOGLE_CLIENT_ID}from'../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=()=>{const[user,setUser]=useState(null);const[blogContent,setBlogContent]=useState(null);// State to store blog content\n// Load user and session from localStorage on component mount\nuseEffect(()=>{const storedUser=localStorage.getItem('user');if(storedUser){setUser(JSON.parse(storedUser));}},[]);useEffect(()=>{const handleCredentialResponse=response=>{console.log('Encoded JWT ID token:',response.credential);// Send the token to your backend for verification\nfetch(`${API_URL}/auth/loginGoogleToken`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({token:response.credential})}).then(res=>{if(!res.ok){throw new Error('Failed to log in');}return res.json();}).then(data=>{console.log('Response from backend:',data);// Persist the user's email, name, and session ID in localStorage\nlocalStorage.setItem('user',JSON.stringify({email:data.email,name:data.name}));localStorage.setItem('sessionId',data.sessionId);// Update state\nsetUser({email:data.email,name:data.name});}).catch(error=>{console.error('Error during login:',error);});};const loadGoogleScript=()=>{const script=document.createElement('script');script.src='https://accounts.google.com/gsi/client';script.async=true;script.defer=true;script.onload=()=>{console.log('Google One Tap script loaded');window.google.accounts.id.initialize({client_id:GOOGLE_CLIENT_ID,callback:handleCredentialResponse,auto_select:true});window.google.accounts.id.prompt();};script.onerror=()=>{console.error('Failed to load Google One Tap script');};document.body.appendChild(script);};if(!document.getElementById('google-one-tap-script')){loadGoogleScript();}},[]);// Fetch blog content if the user is signed in\nuseEffect(()=>{if(user){const sessionId=localStorage.getItem('sessionId');if(sessionId){fetch(`${API_URL}/blog`,{method:'GET',headers:{Authorization:`Bearer ${sessionId}`// Pass the session ID in the Authorization header\n}}).then(res=>{if(!res.ok){throw new Error('Failed to fetch blog content');}return res.text();// Assuming the blog content is plain text or HTML\n}).then(content=>{setBlogContent(content);// Store the blog content in state\n}).catch(error=>{console.error('Error fetching blog content:',error);});}}},[user]);// Logout function\nconst handleLogout=()=>{const sessionId=localStorage.getItem('sessionId');// Retrieve the session ID from localStorage\nif(sessionId){// Call the backend's logout endpoint\nfetch(`${API_URL}/auth/logout`,{method:'POST',headers:{'Content-Type':'application/json',Authorization:`Bearer ${sessionId}`// Pass the session ID in the Authorization header\n}}).then(res=>{if(!res.ok){throw new Error('Failed to log out');}console.log('Logout successful');}).catch(error=>{console.error('Error during logout:',error);});}// Clear user and session data from localStorage\nlocalStorage.removeItem('user');localStorage.removeItem('sessionId');// Clear user state\nsetUser(null);setBlogContent(null);// Clear blog content\nconsole.log('User logged out');};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Login\"}),user?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\"Welcome, \",user.name,\"!\"]}),\" \",/*#__PURE__*/_jsx(\"button\",{onClick:handleLogout,children:\"Logout\"}),\" \",blogContent?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Blog\"}),/*#__PURE__*/_jsx(\"div\",{dangerouslySetInnerHTML:{__html:blogContent}}),\" \"]}):/*#__PURE__*/_jsx(\"p\",{children:\"Loading blog content...\"})]}):/*#__PURE__*/_jsx(\"p\",{children:\"Google One Tap will appear automatically if you're eligible.\"})]});};export default Login;","map":{"version":3,"names":["React","useEffect","useState","API_URL","GOOGLE_CLIENT_ID","jsx","_jsx","jsxs","_jsxs","Login","user","setUser","blogContent","setBlogContent","storedUser","localStorage","getItem","JSON","parse","handleCredentialResponse","response","console","log","credential","fetch","method","headers","body","stringify","token","then","res","ok","Error","json","data","setItem","email","name","sessionId","catch","error","loadGoogleScript","script","document","createElement","src","async","defer","onload","window","google","accounts","id","initialize","client_id","callback","auto_select","prompt","onerror","appendChild","getElementById","Authorization","text","content","handleLogout","removeItem","children","onClick","dangerouslySetInnerHTML","__html"],"sources":["/Users/ayoung/work/src/github.com/dcwb/frontend/src/components/Login.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { API_URL, GOOGLE_CLIENT_ID } from '../config';\n\ndeclare global {\n    interface Window {\n        google: any;\n    }\n}\n\nconst Login: React.FC = () => {\n    const [user, setUser] = useState<{ email: string; name: string } | null>(null);\n    const [blogContent, setBlogContent] = useState<string | null>(null); // State to store blog content\n\n    // Load user and session from localStorage on component mount\n    useEffect(() => {\n        const storedUser = localStorage.getItem('user');\n        if (storedUser) {\n            setUser(JSON.parse(storedUser));\n        }\n    }, []);\n\n    useEffect(() => {\n        const handleCredentialResponse = (response: any) => {\n            console.log('Encoded JWT ID token:', response.credential);\n\n            // Send the token to your backend for verification\n            fetch(`${API_URL}/auth/loginGoogleToken`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                },\n                body: JSON.stringify({ token: response.credential }),\n            })\n                .then((res) => {\n                    if (!res.ok) {\n                        throw new Error('Failed to log in');\n                    }\n                    return res.json();\n                })\n                .then((data) => {\n                    console.log('Response from backend:', data);\n\n                    // Persist the user's email, name, and session ID in localStorage\n                    localStorage.setItem('user', JSON.stringify({ email: data.email, name: data.name }));\n                    localStorage.setItem('sessionId', data.sessionId);\n\n                    // Update state\n                    setUser({ email: data.email, name: data.name });\n                })\n                .catch((error) => {\n                    console.error('Error during login:', error);\n                });\n        };\n\n        const loadGoogleScript = () => {\n            const script = document.createElement('script');\n            script.src = 'https://accounts.google.com/gsi/client';\n            script.async = true;\n            script.defer = true;\n            script.onload = () => {\n                console.log('Google One Tap script loaded');\n                window.google.accounts.id.initialize({\n                    client_id: GOOGLE_CLIENT_ID,\n                    callback: handleCredentialResponse,\n                    auto_select: true,\n                });\n                window.google.accounts.id.prompt();\n            };\n            script.onerror = () => {\n                console.error('Failed to load Google One Tap script');\n            };\n            document.body.appendChild(script);\n        };\n\n        if (!document.getElementById('google-one-tap-script')) {\n            loadGoogleScript();\n        }\n    }, []);\n\n    // Fetch blog content if the user is signed in\n    useEffect(() => {\n        if (user) {\n            const sessionId = localStorage.getItem('sessionId');\n            if (sessionId) {\n                fetch(`${API_URL}/blog`, {\n                    method: 'GET',\n                    headers: {\n                        Authorization: `Bearer ${sessionId}`, // Pass the session ID in the Authorization header\n                    },\n                })\n                    .then((res) => {\n                        if (!res.ok) {\n                            throw new Error('Failed to fetch blog content');\n                        }\n                        return res.text(); // Assuming the blog content is plain text or HTML\n                    })\n                    .then((content) => {\n                        setBlogContent(content); // Store the blog content in state\n                    })\n                    .catch((error) => {\n                        console.error('Error fetching blog content:', error);\n                    });\n            }\n        }\n    }, [user]);\n\n    // Logout function\n    const handleLogout = () => {\n        const sessionId = localStorage.getItem('sessionId'); // Retrieve the session ID from localStorage\n\n        if (sessionId) {\n            // Call the backend's logout endpoint\n            fetch(`${API_URL}/auth/logout`, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    Authorization: `Bearer ${sessionId}`, // Pass the session ID in the Authorization header\n                },\n            })\n                .then((res) => {\n                    if (!res.ok) {\n                        throw new Error('Failed to log out');\n                    }\n                    console.log('Logout successful');\n                })\n                .catch((error) => {\n                    console.error('Error during logout:', error);\n                });\n        }\n\n        // Clear user and session data from localStorage\n        localStorage.removeItem('user');\n        localStorage.removeItem('sessionId');\n\n        // Clear user state\n        setUser(null);\n        setBlogContent(null); // Clear blog content\n\n        console.log('User logged out');\n    };\n\n    return (\n        <div>\n            <h2>Login</h2>\n            {user ? (\n                <div>\n                    <p>Welcome, {user.name}!</p> {/* Display the user's name */}\n                    <button onClick={handleLogout}>Logout</button> {/* Logout button */}\n                    {blogContent ? (\n                        <div>\n                            <h3>Blog</h3>\n                            <div dangerouslySetInnerHTML={{ __html: blogContent }} /> {/* Render blog content */}\n                        </div>\n                    ) : (\n                        <p>Loading blog content...</p>\n                    )}\n                </div>\n            ) : (\n                <p>Google One Tap will appear automatically if you're eligible.</p>\n            )}\n        </div>\n    );\n};\n\nexport default Login;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}